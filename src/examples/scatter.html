<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>RespVis - Scatterplot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <style>
      #chart {
        width: 100%;
        height: 50vh;
        min-height: 25rem;
      }

      body {
        background-color: floralwhite;
      }
    </style>
  </head>
  <body>
    <h1>Scatterplot</h1>
    <div id="chart"></div>
    <script src="./d3/d3.v6.js"></script>
    <script src="../respvis.js"></script>
    <script type="module">
      import data from './data/houses.js';

      const areas = data.area,
        minArea = Math.min(...areas),
        maxArea = Math.max(...areas),
        areaSpan = maxArea - minArea,
        areaDomain = [0, maxArea + areaSpan * 0.2],
        areaFormatter = (area) => `${area}ftÂ²`,
        areaScale = respVis.linearScale().domain(areaDomain),
        areaAxisTitle = 'Area';

      const prices = data.price.map((price) => price / 1000),
        minPrice = Math.min(...prices),
        maxPrice = Math.max(...prices),
        priceSpan = maxPrice - minPrice,
        priceDomain = [0, maxPrice + priceSpan * 0.2],
        priceFormatter = (price) => `$${price}k`,
        priceScale = respVis.linearScale().domain(priceDomain),
        priceAxisTitle = 'Price';

      const radiuses = prices.map((_) => 1),
        radiusScale = respVis.linearScale().domain([0, 1]).range([5, 5]);

      const wideMediaQuery = 'screen and (min-width: 40rem)';

      // chart
      const chart = respVis.chart(),
        root = chart.root().layout('margin-horizontal', 20).layout('margin-top', 20);

      // scatter chart
      const scatterChart = respVis.cartesianChart(),
        drawArea = scatterChart.drawArea();
      root.child('scatterChart', scatterChart);

      // zoom
      const zoom = respVis
        .zoom()
        .scaleExtent([1, 30])
        .on('zoom', (e, d) => handleZoom(d.zoomEvent));
      drawArea.child('zoom', zoom);

      // points
      const points = respVis
        .points()
        .mainValues(areas)
        .mainScale(areaScale)
        .crossValues(prices)
        .crossScale(priceScale)
        .radiuses(radiuses)
        .radiusScale(radiusScale)
        .attr('stroke', '#000000');
      zoom.child('points', points);

      // responsive configuration
      scatterChart
        .configurator(0, (c) => c.call(configureAxes, 5))
        .mediaQueryConfigurator(1, wideMediaQuery, (c) => c.call(configureAxes, 10));

      // mount chart
      chart.mount('#chart');

      function configureAxes(chart, xAxisTicks) {
        chart
          .xAxis()
          .ticks()
          .scale(areaScale)
          .onConfigureAxis((axis) => axis.tickFormat(areaFormatter).ticks(xAxisTicks));
        chart.xAxis().title().text(areaAxisTitle);

        chart
          .yAxis()
          .ticks()
          .scale(priceScale)
          .onConfigureAxis((axis) => axis.tickFormat(priceFormatter));
        chart.yAxis().title().text(priceAxisTitle);
      }

      function handleZoom(zoomEvent) {
        respVis.rescaleX(zoomEvent.transform, areaScale, areaDomain);
        respVis.rescaleY(zoomEvent.transform, priceScale, priceDomain);

        chart.render();
      }
    </script>
  </body>
</html>
