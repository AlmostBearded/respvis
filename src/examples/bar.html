<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>RespVis - Bar Chart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      #chart {
        width: 100%;
        height: 50vh;
        min-height: 25rem;
      }

      body {
        background-color: floralwhite;
      }
    </style>
  </head>
  <body>
    <h1>Bar Chart</h1>
    <div id="chart"></div>
    <script src="../respvis.js"></script>
    <script type="module">
      import withPaddingLayout from './components/with-padding-layout.js';
      import withLeftAxis from './components/axis/with-left-axis.js';
      import withBottomAxis from './components/axis/with-bottom-axis.js';
      import withHighlightTick from './components/axis/with-highlight-tick.js';
      import withHighlightBar from './components/bars/with-highlight-bar.js';
      import withShowLabel from './components/bar-labels/with-show-label.js';

      var categories = ['Vienna', 'Graz', 'Linz', 'Salzburg', 'Innsbruck', 'Klagenfurt', 'Villach'];
      var values = [1691000, 222000, 205000, 153000, 132000, 91000, 59000];

      const wideMediaQuery = 'screen and (min-width: 40rem)';

      // bars
      const bars = withHighlightBar(respVis.bars()).config({
        categories: categories,
        values: values,
        orientation: respVis.BarOrientation.Horizontal,
        transitionDuration: 1000,
        events: [
          {
            typenames: 'mouseover',
            callback: (e, d) => hoverBar(d.index, yAxis, xAxis, true),
          },
          {
            typenames: 'mouseout',
            callback: (e, d) => hoverBar(d.index, yAxis, xAxis, false),
          },
        ],
        conditionalConfigs: [
          {
            media: wideMediaQuery,
            config: {
              orientation: respVis.BarOrientation.Vertical,
              events: [
                {
                  typenames: 'mouseover',
                  callback: (e, d) => hoverBar(d.index, xAxis, yAxis, true),
                },
                {
                  typenames: 'mouseout',
                  callback: (e, d) => hoverBar(d.index, xAxis, yAxis, false),
                },
              ],
            },
          },
        ],
      });

      // bar labels
      const barLabels = withShowLabel(respVis.barLabels()).config({
        attributes: {
          text: {
            'dominant-baseline': 'middle',
            'text-anchor': 'start',
            transform: 'translate(4, 0)',
            'font-weight': 'bold',
            'pointer-events': 'none',
          },
        },
        bars: bars,
        labels: values,
        horizontalPosition: respVis.HorizontalPosition.Left,
        verticalPosition: respVis.VerticalPosition.Center,
        transitionDuration: 1000,
        conditionalConfigs: [
          {
            media: wideMediaQuery,
            config: {
              attributes: {
                text: {
                  'dominant-baseline': 'auto',
                  'text-anchor': 'middle',
                  transform: 'translate(0, -2)',
                },
              },
              horizontalPosition: respVis.HorizontalPosition.Center,
              verticalPosition: respVis.VerticalPosition.Top,
            },
          },
        ],
      });

      // bottom axis
      const xAxis = withHighlightTick(withBottomAxis(respVis.group())).config({
        ticks: {
          scale: bars.valuesScale(),
          attributes: {
            text: {
              'dominant-baseline': 'hanging',
              transform: 'translate(0, 7) rotate(-45)',
              'text-anchor': 'end',
            },
          },
          conditionalConfigs: [
            {
              media: wideMediaQuery,
              config: {
                scale: bars.categoriesScale(),
                attributes: { text: { transform: 'translate(0, 7)', 'text-anchor': 'middle' } },
              },
            },
          ],
        },
        title: {
          text: 'Population',
          conditionalConfigs: [{ media: wideMediaQuery, config: { text: 'Cities' } }],
        },
      });

      // left axis
      const yAxis = withHighlightTick(withLeftAxis(respVis.group())).config({
        ticks: {
          scale: bars.categoriesScale(),
          conditionalConfigs: [{ media: wideMediaQuery, config: { scale: bars.valuesScale() } }],
        },
        title: {
          text: 'Cities',
          conditionalConfigs: [{ media: wideMediaQuery, config: { text: 'Population' } }],
        },
      });

      const chart = respVis
        .chart()
        .root(
          withPaddingLayout(respVis.group()).config({
            all: 10,
            conditionalConfigs: [{ media: wideMediaQuery, config: { top: 20 } }],
            children: [
              respVis.group().config({
                attributes: { 'grid-template': '1fr auto / auto 1fr' },
                children: [
                  // bars
                  bars.config({ attributes: { 'grid-area': '1 / 2 / 2 / 3' } }),

                  // bar Labels
                  barLabels.config({ attributes: { 'grid-area': '1 / 2 / 2 / 3' } }),

                  // left axis
                  yAxis.config({ attributes: { 'grid-area': '1 / 1 / 2 / 2' } }),

                  // bottom axis
                  xAxis.config({ attributes: { 'grid-area': '2 / 2 / 3 / 3' } }),
                ],
              }),
            ],
          })
        )
        .mount('#chart');

      function hoverBar(barIndex, categoryAxis, valueAxis, hover) {
        // Clear highlights of wrong axis in case unhighlight never got called
        valueAxis.clearHighlights();

        bars.highlightBar(barIndex, hover);
        barLabels.showLabel(barIndex, hover);
        categoryAxis.highlightTick(barIndex, hover);

        chart.update();
      }
    </script>
  </body>
</html>
